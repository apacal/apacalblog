

<div class="gallery container">
    <div class="gallery_btn" id="gallery_{$gallery_id}">
        <button type="button" class="btn btn-default" onclick="addPhotoToGallery({$gallery_id});"><i class="glyphicon glyphicon-plus"></i>&nbsp;Add Photo</button>
        &nbsp;&nbsp;&nbsp;
        <button type="button" class="btn btn-default"><i class="glyphicon glyphicon-th-list"></i>&nbsp;Batch Manage</button>
    </div>

        <volist name="gallery" id="vo">
            <div class="thumbnail gallery_item" title="{$vo.title}" href="{$vo.image}">


                <img src="{$vo.image}" href="{$vo.image}" alt="{$vo.title}">


                <div class="caption">
                    <span class="gallery_item_title">{$vo.title}</span>
                </div>
                <div class="btn-group gallery_item_manage">
                    <button type="button" class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#">Edit</a></li>
                        <li><a href="#">Remove</a></li>
                        <li><a href="#">Set Cover</a></li>
                        <li class="divider"></li>
                        <li><a href="#">Delete</a></li>
                    </ul>
                </div>


            </div>
        </volist>
</div>

    <style>
        .gallery_item {
            max-width: 200px;
            max-height:200px;
            float: left;
            margin-top: 20px;
            margin-right: 30px;
            margin-left: 10px;
        }
        .gallery_item_title {
            font-weight: 150;
        }
        .gallery_item_manage {
            position: relative;
            top: -180px;
            right: -108px;
        }
        .gallery_btn {
            margin-top: 30px;
            margin-left: 10px;
        }
        .gallery_photo_modal_body {
            margin-top: 40px;
            margin-bottom:80px;
        }
        #gallery_photo_thumb img {
            max-height: 250px;
            margin: auto;
        }
    </style>

<script type="text/javascript">
    function addPhotoToGallery(gallery_id) {
        window.gallery_id = gallery_id;

        console.log(gallery_id);
        $('#add-photo-to-gallery-modal').modal('show')
    }
    function BrowseServerInGallery()
    {
        // You can use the "CKFinder" class to render CKFinder in a page:
        var finder = new CKFinder();
        finder.basePath = '../';	// The path for the installation of CKFinder (default = "/ckfinder/").
        finder.selectActionFunction = SetFileFieldInGallery;
        //finder.selectActionData = functionData;
        finder.popup();

        // It can also be done in a single line, calling the "static"
        // popup( basePath, width, height, selectFunction ) function:
        // CKFinder.popup( '../', null, null, SetFileField ) ;
        //
        // The "popup" function can also accept an object as the only argument.
        // CKFinder.popup( { basePath : '../', selectActionFunction : SetFileField } ) ;
    }

    // This is a sample function which is called when a file is selected in CKFinder.
    function SetFileFieldInGallery( fileUrl ) {
        //var gallery_id = data["selectActionData"];

        //alert(gallery_id);
        $("#gallery_photo").val(fileUrl);

        var html = '<img class="thumbnail" src="' + fileUrl + '">';
        $("#gallery_photo_thumb").html(html);
    }

    function saveGalleryItemByAjax(gallery_id, title, image) {
        $.ajax({
            url: '/Admin/Gallery/saveGalleryItem',
            type: 'get',
            data: {
                'gallery_id' : gallery_id,
                'image' : image,
                'title' : title
            },
            error: function(XMLHttpRequest, textStatus, errorThrown){
                sweetAlert( "Server Status: " + XMLHttpRequest.status, XMLHttpRequest.statusText, "error");

            },
            success: function(data,status){
                if (status == 'success') {
                    console.log(data);
                    data = JSON.parse(data);
                    if (data.code != '0') {
                        error(data.data);
                    } else {
                        // add html to gallery div

                        $("#gallery_photo_title").val('');
                        $("#gallery_photo").val('');
                        $("#gallery_photo_thumb").html('');
                        $("#gallery_photo_modal").modal('hidden');
                    }
                } else {
                    error("Server Statue: " + status);
                }
            }
        });

    }


    function saveGalleryItem() {
        var title = $("#gallery_photo_title").val();
        var image = $("#gallery_photo").val();


        if (title == '') {
            sweetAlert('title cant be empty!');
            return 1;
        }

        if (image == '') {
            sweetAlert('image cant be empty!');
            return 1;
        }

        saveGalleryItemByAjax(window.gallery_id, title, image);

    }
</script>
